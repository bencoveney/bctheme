<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BCTheme</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
      }

      .wrapper {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        margin-top: 1rem;
      }

      .sliders {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }

      .color-preview {
        margin-top: 1rem;
        padding: 1rem;
        gap: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .text-white {
        color: white;
      }

      .text-black {
        color: black;
      }

      .color-stops {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1rem;
      }

      .color-stop {
        min-width: 15rem;
        min-height: 6rem;
      }

      .color-tint {
        padding: 0.5rem 1rem;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <h1>BCTheme</h1>
      <form class="sliders">
        <label for="hue"> Hue (Degrees) </label>
        <input type="range" name="hue" min="0" max="360" step="1" />
        <label for="saturation"> Saturation (Percent) </label>
        <input type="range" name="saturation" min="0" max="100" step="1" />
        <label for="lightness"> Lightness (Percent) </label>
        <input type="range" name="lightness" min="0" max="100" step="1" />
      </form>
      <div class="color-preview">
        <span class="text-white"></span>
        <span class="text-black"></span>
      </div>
      <div class="color-stops"></div>
    </div>
    <script>
      /**
       * https://en.wikipedia.org/wiki/HSL_color_space.
       * Assumes h, s, and l are contained in the set [0, 1] and
       * returns r, g, and b in the set [0, 255].
       */
      function hslToRgb(h, s, l) {
        let r, g, b;
        if (s === 0) {
          r = g = b = l;
        } else {
          const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          const p = 2 * l - q;
          r = hueToRgb(p, q, h + 1 / 3);
          g = hueToRgb(p, q, h);
          b = hueToRgb(p, q, h - 1 / 3);
        }
        return [
          Math.min(Math.floor(r * 256), 255),
          Math.min(Math.floor(g * 256), 255),
          Math.min(Math.floor(b * 256), 255),
        ];
      }

      function hueToRgb(p, q, t) {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1 / 6) return p + (q - p) * 6 * t;
        if (t < 1 / 2) return q;
        if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
        return p;
      }

      /**
       * http://en.wikipedia.org/wiki/HSL_color_space.
       * Assumes r, g, and b are contained in the set [0, 255] and
       * returns h, s, and l in the set [0, 1].
       */
      function rgbToHsl(r, g, b) {
        (r /= 255), (g /= 255), (b /= 255);
        const vmax = Math.max(r, g, b),
          vmin = Math.min(r, g, b);
        let h,
          s,
          l = (vmax + vmin) / 2;
        if (vmax === vmin) {
          return [0, 0, l];
        }
        const d = vmax - vmin;
        s = l > 0.5 ? d / (2 - vmax - vmin) : d / (vmax + vmin);
        if (vmax === r) h = (g - b) / d + (g < b ? 6 : 0);
        if (vmax === g) h = (b - r) / d + 2;
        if (vmax === b) h = (r - g) / d + 4;
        h /= 6;

        return [h, s, l];
      }

      function rgbToYiq(r, g, b) {
        return (r * 299 + g * 587 + b * 114) / 1000;
      }

      window.addEventListener("load", () => {
        const hueField = document.forms[0].elements.hue;
        const saturationField = document.forms[0].elements.saturation;
        const lightnessField = document.forms[0].elements.lightness;

        const hslBox = document.querySelector(".color-preview");
        const hslLabels = hslBox.querySelectorAll(".text-white, .text-black");

        const updateFastPreview = (event) => {
          let hue = hueField.value;
          let saturation = saturationField.value;
          let lightness = lightnessField.value;
          const color = `hsl(${hue}deg ${saturation}% ${lightness}%)`;
          const [r, g, b] = hslToRgb(
            hue / 360,
            saturation / 100,
            lightness / 100
          );
          const y = rgbToYiq(r, g, b);
          const message = `${color} rgb(${r} ${g} ${b}) ${Math.round(
            (y / 255) * 1000
          )}`;
          hslBox.style.background = color;
          hslLabels.forEach((element) => (element.textContent = message));
        };

        hueField.addEventListener("input", updateFastPreview);
        saturationField.addEventListener("input", updateFastPreview);
        lightnessField.addEventListener("input", updateFastPreview);
        updateFastPreview();

        const colorStopsEl = document.querySelector(".color-stops");
        const colorTintsList = [];
        const stopCount = 12;
        const tintTargets = [
          50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 950,
        ];
        const degPerStop = 360 / stopCount;

        for (let i = 0; i < stopCount; i++) {
          const stopEl = document.createElement("div");
          stopEl.classList.add("color-stop");
          colorStopsEl.appendChild(stopEl);
          const tints = [];
          for (let j = 0; j < tintTargets.length; j++) {
            const tintEl = document.createElement("div");
            tintEl.classList.add("color-tint");
            stopEl.appendChild(tintEl);
            tints.push(tintEl);
          }
          colorTintsList.push(tints);
        }

        const updateColorsPreview = () => {
          let hue = parseInt(hueField.value);
          let saturation = parseInt(saturationField.value);

          let nextHue = hue;
          for (let i = 0; i < stopCount; i++) {
            const tintEls = colorTintsList[i];
            for (let j = 0; j < tintTargets.length; j++) {
              const tintEl = tintEls[j];
              const lightness = tintTargets[j] / 10;
              const [r, g, b] = hslToRgb(
                nextHue / 360,
                saturation / 100,
                lightness / 100
              );
              const y = rgbToYiq(r, g, b);
              const scaledY = Math.floor((y / 255) * 1000);
              tintEl.style.background = `hsl(${nextHue}deg ${saturation}% ${lightness}%)`;
              tintEl.textContent = `hsl(${nextHue}deg ${saturation}% ${lightness}%) ${scaledY}`;
              if (scaledY > 500) {
                tintEl.classList.remove("text-white");
                tintEl.classList.add("text-black");
              } else {
                tintEl.classList.remove("text-black");
                tintEl.classList.add("text-white");
              }
            }
            nextHue = (nextHue + degPerStop) % 360;
          }
        };

        hueField.addEventListener("change", updateColorsPreview);
        saturationField.addEventListener("change", updateColorsPreview);
        lightnessField.addEventListener("change", updateColorsPreview);
        updateColorsPreview();
      });
    </script>
  </body>
</html>
