<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BCTheme</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
      }

      .wrapper {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        margin-top: 1rem;
      }

      .sliders {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }

      .color-preview {
        margin-top: 1rem;
        padding: 1rem;
        gap: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .text-white {
        color: white;
      }

      .text-black {
        color: black;
      }

      .color-stops {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 1rem;
      }

      .color-stop {
        min-width: 15rem;
        min-height: 6rem;
      }

      .color-tint {
        padding: 0.5rem 1rem;
      }

      .reference-table {
        margin-top: 1rem;
        border-collapse: collapse;
        table-layout: fixed;
      }

      .reference-table th,
      .reference-table td {
        padding: 0.25rem 1rem;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <h1>BCTheme</h1>
      <form class="sliders">
        <label for="hue"> Hue (Degrees) </label>
        <input type="range" name="hue" min="0" max="360" step="1" />
        <label for="saturation"> Saturation (Percent) </label>
        <input type="range" name="saturation" min="0" max="100" step="1" />
      </form>
      <div class="color-preview">
        <span class="text-white"></span>
        <span class="text-black"></span>
      </div>
      <div class="color-stops"></div>
      <table class="reference-table">
        <thead>
          <tr>
            <th width="50"></th>
            <th>Color</th>
            <th>Tint</th>
            <th>Hex</th>
          </tr>
        </thead>
        <tbody class="reference-table-rows"></tbody>
      </table>
    </div>
    <script type="module">
      import {
        hslToRgb,
        rgbToYiq,
        hspToRgb,
        rgbToHsp,
        roundTo,
      } from "./color-functions.js";
      import {
        tailwindColors,
        materialDesignColors,
      } from "./reference-colors.js";

      window.addEventListener("load", () => {
        const hueField = document.forms[0].elements.hue;
        const saturationField = document.forms[0].elements.saturation;

        const hslBox = document.querySelector(".color-preview");
        const hslLabels = hslBox.querySelectorAll(".text-white, .text-black");

        const updateFastPreview = (event) => {
          let hue = hueField.value;
          let saturation = saturationField.value;
          let lightness = 50;
          const color = `hsl(${hue}deg ${saturation}% ${lightness}%)`;
          const [r, g, b] = hslToRgb(
            hue / 360,
            saturation / 100,
            lightness / 100
          );
          const y = rgbToYiq(r, g, b);
          const message = `${color} rgb(${r} ${g} ${b}) ${Math.round(
            (y / 255) * 1000
          )}`;
          hslBox.style.background = color;
          hslLabels.forEach((element) => (element.textContent = message));
        };

        hueField.addEventListener("input", updateFastPreview);
        saturationField.addEventListener("input", updateFastPreview);
        updateFastPreview();

        const colorStopsEl = document.querySelector(".color-stops");
        const colorTintsList = [];
        const stopCount = 12;
        const tintTargets = [
          50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 950,
        ];
        const degPerStop = 360 / stopCount;

        for (let i = 0; i < stopCount; i++) {
          const stopEl = document.createElement("div");
          stopEl.classList.add("color-stop");
          colorStopsEl.appendChild(stopEl);
          const tints = [];
          for (let j = 0; j < tintTargets.length; j++) {
            const tintEl = document.createElement("div");
            tintEl.classList.add("color-tint");
            stopEl.appendChild(tintEl);
            tints.push(tintEl);
          }
          colorTintsList.push(tints);
        }

        const updateColorsPreview = () => {
          let hue = parseInt(hueField.value);
          let saturation = parseInt(saturationField.value);

          let nextHue = hue;
          for (let i = 0; i < stopCount; i++) {
            const tintEls = colorTintsList[i];
            for (let j = 0; j < tintTargets.length; j++) {
              const tintEl = tintEls[j];
              const targetTint = tintTargets[j];
              const [r, g, b] = hspToRgb(
                nextHue / 360,
                saturation / 100,
                targetTint / 1000
              );
              const [h, s, p] = rgbToHsp(r, g, b);
              const clampedR = Math.round(r * 255);
              const clampedG = Math.round(g * 255);
              const clampedB = Math.round(b * 255);
              const rbg = `rgb(${clampedR} ${clampedG} ${clampedB})`;
              tintEl.style.background = rbg;
              // tintEl.textContent = `hsl(${nextHue}deg ${saturation}% ${lightness}%) ${scaledY}`;
              tintEl.innerHTML = `in(${roundTo(nextHue / 360, 2)} ${roundTo(
                saturation / 100,
                2
              )} ${roundTo(targetTint / 1000, 2)})<br/>out(${roundTo(
                h,
                2
              )} ${roundTo(s, 2)} ${roundTo(p, 2)})<br/>${rbg}`;
              if (targetTint > 500) {
                tintEl.classList.remove("text-white");
                tintEl.classList.add("text-black");
              } else {
                tintEl.classList.remove("text-black");
                tintEl.classList.add("text-white");
              }
            }
            nextHue = (nextHue + degPerStop) % 360;
          }
        };

        hueField.addEventListener("change", updateColorsPreview);
        saturationField.addEventListener("change", updateColorsPreview);
        updateColorsPreview();

        const rows = document.querySelector(".reference-table-rows");
        function addRow(set, name, tint, hex) {
          const row = document.createElement("tr");
          rows.appendChild(row);

          const previewCell = document.createElement("td");
          row.appendChild(previewCell);
          previewCell.style.backgroundColor = hex;

          const setCell = document.createElement("td");
          row.appendChild(setCell);
          setCell.innerText = set;

          const colorCell = document.createElement("td");
          row.appendChild(colorCell);
          colorCell.innerText = name;

          const tintCell = document.createElement("td");
          row.appendChild(tintCell);
          tintCell.innerText = tint;

          const hexCell = document.createElement("td");
          row.appendChild(hexCell);
          hexCell.innerText = hex;
        }
        Object.entries(tailwindColors).forEach(([name, hex]) => {
          const parts = name.split("-");
          const tint = parts.length > 1 ? parts[parts.length - 1] : "";
          const nameParts = parts.length > 1 ? parts.slice(0, -1) : parts;
          addRow("Tailwind", nameParts.join(" "), tint, hex);
        });
        Object.entries(materialDesignColors).forEach(([name, hex]) => {
          const parts = name.split("-");
          const tint = parts.length > 1 ? parts[parts.length - 1] : "";
          const nameParts = parts.length > 1 ? parts.slice(0, -1) : parts;
          addRow("Material", nameParts.join(" "), tint, hex);
        });
      });
    </script>
  </body>
</html>
